<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>exo 2</title>
  </head>
  <style type="text/css">
    .axis path,
    .axis line {
      fill: none;
      stroke: black;
    }
    .axis text {
      font-family: sans-serif;
      font-size: 8px;
    }
  </style>
  <body></body>

  <script type="module">
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

    //create table N of 20 random numbers between 0 and 100

    //create table N of 20 random numbers between 0 and 100
    // const N = [...Array(20)].map(() => Math.floor(Math.random() * 30));
    // console
    // const N = [
    //   96, 9, 94, 71, 94, 14, 41, 2, 60, 1, 78, 42, 93, 35, 33, 98, 96, 37, 96,
    //   31,
    // ];
    const N = [
      13, 12, 25, 2, 11, 21, 22, 28, 29, 4, 27, 8, 2, 7, 20, 1, 3, 19, 23, 6,
    ];

    const width = 920;
    const height = 600;

    const margin = 20;

    let xScale;

    async function barChar(arrayOfNumbers) {
      xScale = d3
        .scaleBand()
        .domain(arrayOfNumbers.map((n, i) => i))
        // .axisBottom(Array.from({ length: N.length }, (value, index) => index))
        .range([margin, width - margin])
        .padding(0.05);

      const svg = d3
        .select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height + 100)
        .attr("viewBox", [0, 0, width, height])
        .attr("style", "max-width: 100%; height: auto;")
        .append("g")
        .attr("transform", "translate(" + margin + "," + margin + ")");

      let yDomainMin = d3.min(arrayOfNumbers, (d) => {
        return +d;
      });
      let yDomainMax = d3.max(arrayOfNumbers, (d) => {
        return +d;
      });

      const yScale = d3
        .scaleLinear()
        .domain([0, yDomainMax])
        .range([height - margin, margin]);

      svg
        .selectAll("rect")
        .data(arrayOfNumbers)
        .enter()
        .append("rect")
        .attr("id", (d, i) => `p${i}`)
        .attr("x", function (d, i) {
          return xScale(i);
          //   return arrayOfNumbers.indexOf(d);
        })
        .attr("y", function (d) {
          return yScale(d);
        })
        .attr("width", function (d) {
          return xScale.bandwidth();
        })
        .attr("height", function (d) {
          return height - yScale(d) - margin;
        })
        .style("fill", "#69b3a2");

      let xAxis = d3.axisBottom(xScale).ticks(N.length);

      let yAxis = d3.axisLeft(yScale).ticks(30);

      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", "translate(" + margin + ", 0)")
        .call(yAxis);

      svg
        .append("g")
        .attr("class", "axis")
        .attr("class", "xAxis")
        .attr("transform", `translate(${0}, ${height - margin})`)
        .call(xAxis);

      // await update(1, 2);
      // await update(19, 1);
      // await update(9, 3);
      // await update(9, 4);

      // await bubbleSort(N);
      await Sort(N);
      return svg.model;
    }

    const delay = (ms) => new Promise((res) => setTimeout(res, ms));

    async function update(startIdx, endIdx) {
      // setTimeout("", 1000);
      await delay(1500);
      const startBar = d3.select(`#p${startIdx}`);
      const endBar = d3.select(`#p${endIdx}`);

      startBar
        .transition()
        .ease(d3.easeLinear)
        .duration(1000)
        .attr("x", xScale(endIdx))
        .attr("id", `p${endIdx}`);

      endBar
        .transition()
        .ease(d3.easeLinear)
        .duration(1000)
        .attr("x", xScale(startIdx))
        .attr("id", `p${startIdx}`);
    }

    async function bubbleSort(arr) {
      for (var i = 0; i < arr.length; i++) {
        // Last i elements are already in place
        for (var j = 0; j < arr.length - i - 1; j++) {
          // Checking if the item at present iteration
          // is greater than the next iteration
          if (arr[j] > arr[j + 1]) {
            // If the condition is true
            // then swap them
            var temp = arr[j];
            arr[j] = arr[j + 1];
            arr[j + 1] = temp;

            await update(j, j + 1);
          }
        }
      }

      // Print the sorted array
    }
    async function Sort(array) {
      for (var i = 0; i < array.length - 1; ++i) {
        for (var j = i + 1; j < array.length; j++) {
          if (array[i] > array[j]) {
            var t = array[i];
            array[i] = array[j];
            array[j] = t;
            await update(i, j);
          }
        }
      }
    }

    // This is our unsorted array
    var arr = [234, 43, 55, 63, 5, 6, 235, 547];

    const svg = barChar(N);
    const N2 = [
      9, 96, 94, 71, 94, 14, 41, 2, 60, 1, 78, 42, 93, 35, 33, 98, 96, 37, 96,
      31,
    ];
  </script>
</html>
